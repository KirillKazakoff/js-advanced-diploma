(()=>{var t={757:(t,e,n)=>{t.exports=n(666)},666:t=>{var e=function(t){"use strict";var e,n=Object.prototype,r=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var a=e&&e.prototype instanceof m?e:m,o=Object.create(a.prototype),i=new A(r||[]);return o._invoke=function(t,e,n){var r=f;return function(a,o){if(r===v)throw new Error("Generator is already running");if(r===d){if("throw"===a)throw o;return S()}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var c=x(i,n);if(c){if(c===p)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===f)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=v;var s=l(t,e,n);if("normal"===s.type){if(r=n.done?d:h,s.arg===p)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r=d,n.method="throw",n.arg=s.arg)}}}(t,n,i),o}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f="suspendedStart",h="suspendedYield",v="executing",d="completed",p={};function m(){}function y(){}function g(){}var w={};w[o]=function(){return this};var C=Object.getPrototypeOf,b=C&&C(C(O([])));b&&b!==n&&r.call(b,o)&&(w=b);var k=g.prototype=m.prototype=Object.create(w);function P(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function L(t,e){function n(a,o,i,c){var s=l(t[a],t,o);if("throw"!==s.type){var u=s.arg,f=u.value;return f&&"object"==typeof f&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,i,c)}),(function(t){n("throw",t,i,c)})):e.resolve(f).then((function(t){u.value=t,i(u)}),(function(t){return n("throw",t,i,c)}))}c(s.arg)}var a;this._invoke=function(t,r){function o(){return new e((function(e,a){n(t,r,e,a)}))}return a=a?a.then(o,o):o()}}function x(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,x(t,n),"throw"===n.method))return p;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=l(r,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,p;var o=a.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,p):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function R(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function O(t){if(t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function n(){for(;++a<t.length;)if(r.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}return{next:S}}function S(){return{value:e,done:!0}}return y.prototype=k.constructor=g,g.constructor=y,y.displayName=s(g,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,s(t,c,"GeneratorFunction")),t.prototype=Object.create(k),t},t.awrap=function(t){return{__await:t}},P(L.prototype),L.prototype[i]=function(){return this},t.AsyncIterator=L,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new L(u(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},P(k),s(k,c,"Generator"),k[o]=function(){return this},k.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(r,a){return c.type="throw",c.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),R(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;R(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),p}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}}},e={};function n(r){var a=e[r];if(void 0!==a)return a.exports;var o=e[r]={exports:{}};return t[r](o,o.exports,n),o.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function e(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}function r(n){return function(e){if(Array.isArray(e))return t(e)}(n)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||e(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){var n=Math.ceil(t),r=Math.floor(e);return Math.floor(Math.random()*(r-n))+n}function o(t,e){var n=this,a=this.boardSize,o=new Set,i=[],c=[],s=[],u=[],l=[],f=[],h=[],v=[];return function(){for(var r=0;r<t+1;r+=1){var a=e+r,c=n.cells[a];if(o.add(a),i.push(a),c.className.includes("right"))return}}(),function(){for(var r=0;r<t+1;r+=1){var a=e-r,i=n.cells[a];if(o.add(a),c.push(a),i.className.includes("left"))return}}(),function(){for(var r=0;r<t+1;r+=1){var i=e-r*a,c=n.cells[i];if(o.add(i),s.push(i),c.className.includes("top"))return}}(),function(){for(var r=0;r<t+1;r+=1){var i=e+r*a,c=n.cells[i];if(o.add(i),u.push(i),c.className.includes("bottom"))return}}(),function(){if(!n.cells[e].className.includes("right"))for(var r=1;r<t+1;r+=1){var i=e-r*(a-1);if(i<0)return;var c=n.cells[i];if(o.add(i),f.push(i),!c.className.includes("center"))return}}(),function(){if(!n.cells[e].className.includes("left"))for(var r=1;r<t+1;r+=1){var i=e+r*(a-1);if(i>=Math.pow(a,2))return;var c=n.cells[i];if(o.add(i),l.push(i),!c.className.includes("center"))return}}(),function(){if(!n.cells[e].className.includes("left"))for(var r=1;r<t+1;r+=1){var i=e-r*(a+1);if(i<0)return;var c=n.cells[i];if(o.add(i),v.push(i),!c.className.includes("center"))return}}(),function(){if(!n.cells[e].className.includes("right"))for(var r=1;r<t+1;r+=1){var i=e+r*(a+1);if(i>=Math.pow(a,2))return;var c=n.cells[i];if(o.add(i),h.push(i),!c.className.includes("center"))return}}(),{positions:r(o),toRight:i,toLeft:c,toBottom:u,toTop:s,toMainDb:l,toMainDt:f,toAuxDb:h,toAuxDt:v}}function i(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const s={boardSize:5,container:null,boardEl:null,cells:[],teams:[],isRangeButton:!1,cellClickListeners:[],cellUpListeners:[],cellDownListeners:[],cellEnterListeners:[],cellLeaveListeners:[],newGameListeners:[],saveGameListeners:[],loadGameListeners:[],checkBinding:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")},bindToDOM:function(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t},drawUi:function(t){var e,n,r,a=this;this.checkBinding(),this.container.innerHTML='\n        <div class="controls">\n            <button data-id="action-restart" class="btn">New Game</button>\n            <button data-id="action-save" class="btn">Save Game</button>\n            <button data-id="action-load" class="btn">Load Game</button>\n        </div>\n        <div class="board-container">\n            <div class="card player-card"></div>\n            <div data-id="board" class="board"></div>\n            <div class="card ai-card"></div>\n        </div>\n        ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),document.addEventListener("keydown",(function(t){return a.onRangeSwitch(t)})),this.newGameEl.addEventListener("click",(function(t){return a.onNewGameClick(t)})),this.saveGameEl.addEventListener("click",(function(t){return a.onSaveGameClick(t)})),this.loadGameEl.addEventListener("click",(function(t){return a.onLoadGameClick(t)})),this.boardEl=this.container.querySelector("[data-id=board]"),this.pickTheme(t),this.boardEl.style["grid-template-columns"]="repeat(".concat(this.boardSize,", 1fr)");for(var o=0;o<Math.pow(this.boardSize,2);o+=1){var i=document.createElement("div");i.classList.add("cell","map-tile","map-tile-".concat((e=o,n=this.boardSize,void 0,r=Math.pow(n,2),0===e?"top-left":e===n-1?"top-right":e<n?"top":e===r-n?"bottom-left":e===r-1?"bottom-right":e>=r-n?"bottom":e%n==0?"left":(e+1)%n==0?"right":"center"))),i.addEventListener("mouseenter",(function(t){return a.onCellEnter(t)})),i.addEventListener("mouseleave",(function(t){return a.onCellLeave(t)})),i.addEventListener("click",(function(t){return a.onCellClick(t)})),i.addEventListener("mousedown",(function(t){return a.onCellDown(t)})),i.addEventListener("mouseup",(function(t){return a.onCellUp(t)})),this.boardEl.appendChild(i)}this.cells=Array.from(this.boardEl.children)},pickTheme:function(t){this.boardEl.className="board ".concat(t)},redrawPositions:function(t){var e,n=i(this.cells);try{for(n.s();!(e=n.n()).done;)e.value.innerHTML=""}catch(t){n.e(t)}finally{n.f()}var r,a,o=i(t);try{for(o.s();!(r=o.n()).done;){var c=r.value,s=this.boardEl.children[c.position],u=document.createElement("div");s.dataset.charData=JSON.stringify(c),u.classList.add("character",c.type);var l=document.createElement("div");l.classList.add("health-level");var f=document.createElement("div");f.classList.add("health-level-indicator","health-level-indicator-".concat((a=c.health)<15?"critical":a<50?"normal":"high")),f.style.width="".concat(c.health,"%"),l.appendChild(f),u.appendChild(l),s.appendChild(u)}}catch(t){o.e(t)}finally{o.f()}},addNewGameListener:function(t){this.newGameListeners.push(t)},addSaveGameListener:function(t){this.saveGameListeners.push(t)},addLoadGameListener:function(t){this.loadGameListeners.push(t)},addCellLeaveListener:function(t){this.cellLeaveListeners.push(t)},addCellClickListener:function(t){this.cellClickListeners.push(t)},addCellDownListener:function(t){this.cellDownListeners.push(t)},addCellUpListener:function(t){this.cellUpListeners.push(t)},addCellEnterListener:function(t){this.cellEnterListeners.push(t)},onCellEnter:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach((function(t){return t(e)}))},onCellLeave:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach((function(t){return t(e)}))},onCellClick:function(t){var e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach((function(t){return t(e)}))},onCellDown:function(t){var e=this,n=this.cells.indexOf(t.currentTarget);this.cellDownListeners.forEach((function(t){e.timer=setTimeout((function(){return t(n)}),500)}))},onCellUp:function(t){var e=this,n=this.cells.indexOf(t.currentTarget);this.cellUpListeners.forEach((function(t){clearTimeout(e.timer),t(n)}))},onRangeSwitch:function(t){"r"===t.key&&(this.isRangeButton=!this.isRangeButton)},onNewGameClick:function(t){t.preventDefault(),this.newGameListeners.forEach((function(t){return t()}))},onSaveGameClick:function(t){t.preventDefault(),this.saveGameListeners.forEach((function(t){return t()}))},onLoadGameClick:function(t){t.preventDefault(),this.loadGameListeners.forEach((function(t){return t()}))},createToolTip:function(t,e){var n=document.createElement("div"),r=e;r.title=t,n.textContent=e.title,n.className="tooltip tooltip-active",r.appendChild(n);var a=function(t){var e=t.getBoundingClientRect(),n=e.top,r=e.bottom,a=e.left,o=e.right;return{top:n+=pageYOffset,bottom:r+=pageYOffset,left:a+=pageXOffset,right:o+=pageXOffset}}(e),o=a.right,i=a.bottom;n.style.left="".concat(o-10,"px"),n.style.top="".concat(i-10,"px")},showCellTooltip:function(t){t.lastElementChild.classList.add("tooltip-active")},hideCellTooltip:function(t){t.lastElementChild.classList.remove("tooltip-active")},selectCell:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.cells[t].classList.add("selected","selected-".concat(e))},deselectCell:function(t){var e,n=this.cells[t];(e=n.classList).remove.apply(e,r(Array.from(n.classList).filter((function(t){return t.startsWith("selected")}))))},deselectAllCells:function(){for(var t=0;t<Math.pow(this.boardSize,2);t+=1)this.deselectCell(t)},showDamage:function(t,e){var n=this;return new Promise((function(r){var a=n.cells[t],o=document.createElement("span");o.textContent=e,o.classList.add("damage"),a.appendChild(o),o.addEventListener("animationend",(function(){a.removeChild(o),r()}))}))},setCursor:function(t){this.boardEl.style.cursor=t},getTeam:function(t){return this.teams.characters.filter((function(e){return e.turn===t}))},getPositions:function(t,e){var n=this.teams.getTeamChar(e);return o.call(this,n[t],e)},clearDataset:function(t){this.cells[t].title=""},clearAllDataset:function(){for(var t=0;t<Math.pow(this.boardSize,2);t+=1)this.clearDataset(t),this.deselectCell(t)}};function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),t}var h=n(757),v=n.n(h),d=function(){function t(e){u(this,t),this.storage=e}return f(t,[{key:"save",value:function(t){this.storage.setItem("state",JSON.stringify(t))}},{key:"load",value:function(){try{return JSON.parse(this.storage.getItem("state"))}catch(t){throw new Error("Invalid state")}}}]),t}(),p=v().mark(y),m=new d(localStorage);function y(){var t,e;return v().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=["prairie","desert","arctic","mountain"],e=0;case 2:return n.next=5,t[e];case 5:(e+=1)>=t.length&&(e=0),n.next=2;break;case 9:case"end":return n.stop()}}),p)}var g=y(),w={theme:null,gamePoints:0,maxGamePoints:0,activePos:null,isCellHolded:null,underControl:!0,toNextLevel:function(){this.theme=g.next().value,w.underControl=!0,w.activePos=null},getMaxPoints:function(){var t=this.maxGamePoints,e=this.gamePoints;this.maxGamePoints=Math.max(t,e)},newGameStart:function(){g=y(),this.toNextLevel(),this.getMaxPoints()},save:function(t){var e={chars:t,theme:this.theme,gamePoints:this.gamePoints,maxGamePoints:this.maxGamePoints,activePos:this.activePos};m.save(e)},load:function(){var t=m.load(),e=t.theme,n=t.gamePoints,r=t.maxGamePoints,a=t.activePos,o=t.chars;return w.theme=e,w.gamePoints=n,w.maxGamePoints=r,w.activePos=a,o}};const C=w;function b(t,e,n,r,a,o,i){try{var c=t[o](i),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(r,a)}function k(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(t){b(o,r,a,i,c,"next",t)}function c(t){b(o,r,a,i,c,"throw",t)}i(void 0)}))}}function P(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function L(t,e){return(L=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function x(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&L(t,e)}function E(t){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function R(t,e){return!e||"object"!==E(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function A(t){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var O=function(){function t(){u(this,t);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.characters=n.reduce((function(t,e){return e.forEach((function(e){return t.push(e)})),t}),[]),this.getAmount()}var e;return f(t,[{key:"getCharsPositions",value:function(){return this.characters.map((function(t){return t.position}))}},{key:"moveActiveChar",value:function(t){s.clearDataset(C.activePos);var e=this.getTeamChar(C.activePos);this.deleteChar(e),e.position=t,this.characters.push(e),s.redrawPositions(s.teams.characters)}},{key:"attackChar",value:(e=k(v().mark((function t(e){var n,r,a;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getTeamChar(C.activePos),t.next=3,s.showDamage(e,n.attack);case 3:return(r=this.getTeamChar(e)).health-=Math.max(n.attack-r.defence,.1*n.attack),a=null,r.health<=0&&(this.deleteChar(r),s.clearDataset(e),s.deselectCell(e),a=e),s.redrawPositions(s.teams.characters),t.abrupt("return",a);case 9:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"getTeamChar",value:function(t){return this.characters.find((function(e){return e.position===t}))||!1}},{key:"getTeam",value:function(t){return this.characters.filter((function(e){return e.turn===t}))}},{key:"getChars",value:function(t){var e=this;return t.reduce((function(t,n){var r=e.getTeamChar(n);return t.push(r),t}),[])}},{key:"deleteChar",value:function(t){var e=this.characters.findIndex((function(e){return e.position===t.position}));this.characters.splice(e,1),C.activePos===t.position&&(C.activePos=null)}},{key:"getAmount",value:function(){this.amount=this.characters.reduce((function(t){return t+1}),0)}},{key:"addChars",value:function(t){var e=this;t.forEach((function(t){return e.characters.push(t)})),this.getAmount()}},{key:"levelUp",value:function(){this.characters.forEach((function(t){C.gamePoints+=+t.health.toFixed(),t.levelUp()}))}}]),t}();function S(t,e){return e.length<1?0:(e.sort((function(e,n){return n[t]-e[t]})),e[0])}function T(t,e){return e.length<1?0:(e.sort((function(e,n){return e[t]-n[t]})),e[0])}function G(t){return r(new Set(t))}function N(t,e){return j.apply(this,arguments)}function j(){return(j=k(v().mark((function t(e,n){return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return C.activePos=e,t.next=3,s.teams.attackChar(n);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function D(t,e){C.activePos=t,s.teams.moveActiveChar(e)}function M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function B(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach((function(e){P(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var I=function(t){x(c,t);var e,n,a,o,i=(a=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=A(a);if(o){var n=A(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return R(this,t)});function c(){return u(this,c),i.apply(this,arguments)}return f(c,[{key:"getAttackPairs",value:function(){return this.getCharsPositions().reduce((function(t,e){return t.push(s.getPositions("attackRange",e).positions),t}),[])}},{key:"getPairsInWarZone",value:function(t){var e=this.getAttackPairs();return t.getCharsPositions().reduce((function(t,n){return e.forEach((function(e){e.some((function(t){return t===n}))&&t.push([e[0],n])})),t}),[])}},{key:"getAttackPos",value:function(t){var e=this.getPairsInWarZone(t).map((function(t){return t[1]}));return"number"!=typeof e[0]?0:G(e)}},{key:"getAttackRange",value:function(){return this.getCharsPositions().reduce((function(t,e){var n=s.getPositions("attackRange",e).positions;return t.push.apply(t,r(n)),t}),[])}},{key:"getBestVictim",value:function(t){try{var e=this.getAttackPos(t);return T("defence",t.getChars(e))}catch(t){return!1}}},{key:"getBestAttacker",value:function(t,e){var n=this.getPairsInWarZone(e).reduce((function(e,n){return n.some((function(r){var a=r===t.position;return a&&e.push(n[0]),a})),e}),[]);return S("attack",this.getChars(n))}},{key:"getAcceptableZone",value:function(t,e){var n=function(t){return s.getPositions("moveRange",t).positions}(e),r=this.getCharsPositions(),a=t.getCharsPositions();return n.filter((function(t){var e=r.every((function(e){return e!==t})),n=a.every((function(e){return e!==t}));return e&&n}))}},{key:"getClearZone",value:function(t,e){var n=this.getAcceptableZone(e,t),r=e.getAttackRange(),a=n.reduce((function(t,e){return r.some((function(t){return t===e}))||t.push(e),G(t)}),[]);return!!a[0]&&a}},{key:"checkBestPos",value:function(t,e,n){var r=this;if(t[0]){var a=[],o=this.getCharsPositions(),i=e;return t.push(e),t.forEach((function(t){C.activePos=i,r.moveActiveChar(t);var c=r.getBestVictim(n),s=r.getBestAttacker(c,n).position;if(c&&!o.some((function(t){return t===s}))){var u=B(B({},c),{},{attackerFuture:s,attackerNow:e});a.push(u)}i=t})),T("defence",a)}return 0}},{key:"safeCheck",value:function(t,e){var n=this.getClearZone(t,e);return n?this.checkBestPos(n,t,e):0}},{key:"dangerCheck",value:function(t,e){var n=this.getAcceptableZone(e,t);return this.checkBestPos(n,t,e)}},{key:"moveToFight",value:function(t){if(t){var e=t.attackerFuture;return D(t.attackerNow,e),t}return!1}},{key:"explore",value:function(t,e){var n=this,r=this.getBestVictim(t),a=T("defence",this.getCharsPositions().reduce((function(r,a){var o=e.call(n,a,t);return o&&r.push(o),r}),[]));return!!(a&&!r||a.defence<r.defence)&&(this.moveToFight(a),!0)}},{key:"makeDecisionAI",value:(n=k(v().mark((function t(e){var n,r,a,o,i=this;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getAttackPos(this),r=this.getAttackPos(e),a=this.getBestVictim(e),o=this.getBestAttacker(a,e),t.abrupt("return",c.giveControlAI((function(){if(1===n.length){var t=n[0],c=i.safeCheck(t,e);if(c)return void i.moveToFight(c);var s=i.getClearZone(t,e);if(s)return void D(t,s[0]);var u=i.dangerCheck(t,e);if(u.defence<a.defence)return void i.moveToFight(u)}if(r){if(i.explore(e,i.safeCheck))return;if(i.explore(e,i.dangerCheck))return;return N(o.position,a.position)}if(!n){if(i.explore(e,i.safeCheck))return;var l=S("attack",i.characters).position,f=i.getClearZone(l,e);return f?void D(l,f[0]):void D(l,i.getAcceptableZone(e,l)[0])}if(n&&!r){var h=T("defence",i.getChars(n)).position,v=i.getClearZone(h,e);if(i.explore(e,i.dangerCheck))return;if(v)return void D(h,v[0]);D(h,i.getAcceptableZone(e,h)[0])}})));case 5:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})}],[{key:"giveControlAI",value:(e=k(v().mark((function t(e){var n,r;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=C.activePos,t.next=3,e(n);case 3:r=t.sent,C.activePos=n,r===n&&(C.activePos=null);case 6:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})}]),c}(O),_=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generic";if(u(this,t),"Character"===(this instanceof t?this.constructor:void 0).name)throw new Error("you can't invoke parent class");this.level=e,this.health=50,this.type=n,this.turn=null,this.position=null}return f(t,[{key:"levelUp",value:function(){this.health>25&&(this.attack+=.3*this.attack,this.defence+=.3*this.defence),this.level+=1,this.health+=80,this.health>100&&(this.health=100)}},{key:"upFromScratch",value:function(){for(var t=this.level,e=1;e<t;e+=1)this.levelUp()}}]),t}();var U=function(t){x(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=A(e);if(n){var a=A(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return R(this,t)});function a(t){var e;return u(this,a),(e=r.call(this,t,"daemon")).defence=30,e.attack=20,e.moveRange=1,e.attackRange=4,e.upFromScratch(),e}return a}(_);var F=function(t){x(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=A(e);if(n){var a=A(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return R(this,t)});function a(t){var e;return u(this,a),(e=r.call(this,t,"vampire")).attack=25,e.defence=25,e.attackRange=2,e.moveRange=2,e.upFromScratch(),e}return a}(_);var Z=function(t){x(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=A(e);if(n){var a=A(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return R(this,t)});function a(t){var e;return u(this,a),(e=r.call(this,t,"undead")).attack=40,e.defence=10,e.moveRange=4,e.attackRange=1,e.upFromScratch(),e}return a}(_);var H=function(t){x(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=A(e);if(n){var a=A(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return R(this,t)});function a(t){var e;return u(this,a),(e=r.call(this,t,"bowman")).attack=25,e.defence=25,e.moveRange=2,e.attackRange=2,e.upFromScratch(),e}return a}(_);var z=function(t){x(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=A(e);if(n){var a=A(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return R(this,t)});function a(t){var e;return u(this,a),(e=r.call(this,t,"swordsman")).attack=40,e.defence=10,e.moveRange=4,e.attackRange=1,e.upFromScratch(),e}return a}(_);var q,V,W=function(t){x(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=A(e);if(n){var a=A(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return R(this,t)});function a(t){var e;return u(this,a),(e=r.call(this,t,"magician")).defence=30,e.attack=20,e.moveRange=1,e.attackRange=4,e.upFromScratch(),e}return a}(_),Y=v().mark(J);function J(t,e){var n,r,o;return v().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n=a(0,t.length),r=a(1,e+1),o=new t[n](r),i.next=6,o;case 6:i.next=0;break;case 8:case"end":return i.stop()}}),Y)}function X(t){var e,n,r=(e=[],n=s.boardSize,function(t){for(var r=function(){var e;return e="AI"===t.turn?a(n-2,n):a(0,2),a(0,n)*n+e},o=r();e.some((function(t){return t===o}));)o=r();e.push(o);var i=t;return i.position=o,i});return t.map((function(t){return r(t)}))}function $(t,e,n){for(var r=J("AI"===n?[U,F,Z]:[H,z,W],t),a=[],o=0;o<e;o+=1){var i=r.next().value;i.turn=n,a.push(i)}return X(a)}function K(){q=new I(s.getTeam("AI")),V=new I(s.getTeam("player"))}function Q(){var t=$(1,2,"player"),e=$(1,2,"AI");s.teams=new O(t,e),s.redrawPositions(s.teams.characters),K()}function tt(){if(C.underControl=!1,K(),q.amount)return q.makeDecisionAI(V).then((function(){var t;C.underControl=!0,K(),V.amount||(t=document.querySelector(".board"),C.getMaxPoints(),s.deselectAllCells(),t.innerHTML=t.innerHTML)}));!function(){C.toNextLevel(),s.pickTheme(C.theme),V.levelUp();var t=function(){var t=null,e=null;switch(C.theme){case"prairie":break;case"desert":e=1,t=1;break;case"arctic":e=2,t=2;break;case"mountain":e=3,t=2}return{amount:t,level:e}}(),e=t.amount,n=t.level,r=$(n,e,"player");V.addChars(r),V.characters=X(V.characters),q=new I($(n+1,V.amount,"AI")),s.teams=new O(q.characters,V.characters),s.clearAllDataset(),s.redrawPositions(s.teams.characters)}()}var et=new H(5),nt=new H(5),rt=new F(4),at=new F(4);et.position=0,nt.position=7,rt.position=6,at.position=13,et.turn="player",nt.turn="player",rt.turn="AI",at.turn="AI";const ot=new O([et,nt,rt,at]);var it=function(){function t(e,n){u(this,t),this.gamePlay=e,this.stateService=n}return f(t,[{key:"init",value:function(){var t=this;C.toNextLevel(),s.drawUi(C.theme),Q(),this.gamePlay.addLoadGameListener((function(){return t=C.load().map((function(t){var e,n=t.level;switch(t.type){case"vampire":e=new F(n);break;case"undead":e=new Z(n);break;case"daemon":e=new U(n);break;case"bowman":e=new H(n);break;case"magician":e=new W(n);break;case"swordsman":e=new z(n)}for(var r in t)e[r]=t[r];return e})),console.log(t),s.drawUi(C.theme),s.teams.characters=t,s.redrawPositions(t),C.activePos&&s.selectCell(C.activePos),void K();var t})),this.gamePlay.addSaveGameListener((function(){return t=s.teams.characters,void C.save(t);var t})),this.gamePlay.addNewGameListener((function(){return C.newGameStart(),s.drawUi(C.theme),void Q()})),this.gamePlay.addCellDownListener((function(e){return t.onCellDown(e)})),this.gamePlay.addCellEnterListener((function(e){return t.onCellEnter(e)})),this.gamePlay.addCellLeaveListener((function(e){return t.onCellLeave(e)})),this.gamePlay.addCellClickListener((function(e){return t.onCellClick(e)})),this.gamePlay.addCellUpListener((function(){return t.onCellUp()}))}},{key:"onCellEnter",value:function(t){var n,r,a=this.getCell(t),o=C.activePos,i=this.gamePlay.teams.getTeamChar(t);if(this.gamePlay.setCursor("pointer"),i)if("tooltip"===a.lastElementChild.className)this.gamePlay.showCellTooltip(a);else{var c=i.level,s=i.attack,u=i.defence,l=i.health,f=(n=["0x1f396","0x2694","0x1f6e1","0x2764"].map((function(t){return String.fromCodePoint(t)})),r=4,function(t){if(Array.isArray(t))return t}(n)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,o=[],i=!0,c=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);i=!0);}catch(t){c=!0,a=t}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}}(n,r)||e(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),h=f[0],v=f[1],d=f[2],p=f[3];this.gamePlay.createToolTip("".concat(h," ").concat(c," ").concat(v," ").concat(s," ").concat(d," ").concat(u," ").concat(p," ").concat(l),a)}if(i||"number"!=typeof o||this.getMoveRange(o).some((function(e){return e===t}))&&this.gamePlay.selectCell(t,"green"),"AI"===i.turn&&"number"==typeof o){if(this.getAttackRange(o).some((function(e){return e===t})))return this.gamePlay.setCursor("crosshair"),void this.gamePlay.selectCell(t,"red");this.gamePlay.setCursor("not-allowed")}"AI"===i.turn&&"number"!=typeof o&&this.gamePlay.setCursor("not-allowed")}},{key:"onCellClick",value:function(t){var e=C.activePos,n=C.underControl,r=this.gamePlay.teams,a=r.getTeamChar(t);a||"number"!=typeof e||!n?("player"!==a.turn&&"number"==typeof e&&this.getAttackRange(e).some((function(e){return e===t}))&&n&&(C.underControl=!1,r.attackChar(t).then((function(){tt()}))),a&&this.onPlayerCharClick(t)):this.getMoveRange(e).some((function(e){return e===t}))&&(r.moveActiveChar(t),this.gamePlay.redrawPositions(r.characters),this.gamePlay.deselectCell(t),this.gamePlay.selectCell(t,"yellow"),this.gamePlay.deselectCell(e),C.activePos=t,tt())}},{key:"onCellLeave",value:function(t){var e=this.getCell(t);e.title&&this.gamePlay.hideCellTooltip(e),(e.className.includes("green")||e.className.includes("red"))&&this.gamePlay.deselectCell(t),C.isCellHolded&&this.onCellUp()}},{key:"onCellDown",value:function(t){var e=this.gamePlay,n=e.isRangeButton;e.teams.getTeamChar(t)&&(this.highlightAttackRange(t,n),this.highlightMoveRange(t,n),C.isCellHolded=!0)}},{key:"onCellUp",value:function(){C.underControl&&(this.gamePlay.deselectAllCells(),"number"==typeof C.activePos&&this.gamePlay.selectCell(C.activePos,"yellow"))}},{key:"highlightAttackRange",value:function(e,n){var r=this;if(n){var a=this.getAttackRange(e);t.exceptChars(a,e).forEach((function(t){return r.gamePlay.selectCell(t,"red")}))}}},{key:"highlightMoveRange",value:function(e,n){var r=this;if(!n){var a=this.getMoveRange(e);t.exceptChars(a,e).forEach((function(t){return r.gamePlay.selectCell(t,"green")}))}}},{key:"onPlayerCharClick",value:function(t){var e=this.gamePlay.teams.getTeamChar(t),n=e.turn,r=e.position,a=C.activePos;"AI"!==n&&(this.gamePlay.selectCell(t),"number"==typeof a&&this.gamePlay.deselectCell(a),a=a===r?null:r,C.isCellHolded&&(this.gamePlay.selectCell(t,"yellow"),a=r,C.isCellHolded=!1),C.activePos=a)}},{key:"getMoveRange",value:function(t){return this.gamePlay.getPositions("moveRange",t).positions}},{key:"getAttackRange",value:function(t){return this.gamePlay.getPositions("attackRange",t).positions}},{key:"getCell",value:function(t){return this.gamePlay.cells[t]}},{key:"initTest",value:function(){C.toNextLevel(),this.gamePlay.teams=ot,this.gamePlay.drawUi(C.theme),this.gamePlay.redrawPositions(this.gamePlay.teams.characters)}}],[{key:"exceptChars",value:function(t,e){return t.reduce((function(t,n){return n!==e&&t.push(n),t}),[])}}]),t}();s.bindToDOM(document.querySelector("#game-container"));var ct=new d(localStorage);new it(s,ct).init()})()})();
//# sourceMappingURL=bundle.js.map